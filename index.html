<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arese OS v2.5 | MAS Build</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <style>
        :root { --blue: #00d2ff; --bg: #050505; --glass: rgba(20, 20, 20, 0.8); --border: #333; --neon-red: #ff4b2b; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        html, body { height: 100dvh; width: 100vw; margin: 0; background: var(--bg); color: #fff; overflow: hidden; display: flex; }

        /* SIDEBAR & OVERLAY */
        #sidebar { width: 280px; background: #0a0a0a; border-right: 1px solid var(--border); position: fixed; left: -280px; height: 100%; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; padding: 20px; display: flex; flex-direction: column; }
        #sidebar.open { left: 0; box-shadow: 20px 0 60px #000; }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1500; display: none; backdrop-filter: blur(2px); }

        .nav-btn { width: 100%; padding: 12px; background: #111; color: #888; border: 1px solid #222; border-radius: 12px; font-weight: 600; cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .nav-btn.active { background: rgba(0, 210, 255, 0.1); color: var(--blue); border-color: var(--blue); }

        /* MAIN APP */
        #app { flex: 1; display: flex; flex-direction: column; height: 100%; position: relative; width: 100%; }
        #header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: #0a0a0a; border-bottom: 1px solid var(--border); }

        /* CHAT VIEW */
        #chat-flow { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; padding-bottom: 150px; }
        
        /* IMAGE VIEW (vision-deck) */
        #vision-deck { position: fixed; inset: 0; background: #050505; z-index: 3000; display: none; flex-direction: column; padding: 20px; }
        #image-gallery { flex: 1; overflow-y: auto; display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        .img-card { background: #111; border: 1px solid #222; border-radius: 15px; overflow: hidden; }
        .img-card img { width: 100%; display: block; }

        /* MESSAGES */
        .msg-container { display: flex; width: 100%; gap: 12px; animation: slideUp 0.3s ease; }
        .user-side { justify-content: flex-end; }
        .ai-avatar { width: 35px; height: 35px; border-radius: 50%; border: 1px solid var(--blue); display: flex; align-items: center; justify-content: center; font-size: 10px; color: var(--blue); background: #111; position: relative; }
        .ring { position: absolute; inset: -3px; border: 2px solid transparent; border-top: 2px solid var(--blue); border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .msg { max-width: 85%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.6; }
        .ai { background: #111; border: 1px solid #222; color: #ddd; border-top-left-radius: 4px; }
        .user { background: var(--blue); color: #000; font-weight: 600; border-top-right-radius: 4px; }

        /* CONTROLS */
        .controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, #000 30%); padding: 20px; }
        
        .mode-menu { display: flex; gap: 8px; margin-bottom: 12px; overflow-x: auto; scrollbar-width: none; }
        .mode-box { min-width: 110px; background: #111; border: 1px solid #222; padding: 8px 12px; border-radius: 12px; cursor: pointer; transition: 0.2s; }
        .mode-box.active { border-color: var(--blue); background: rgba(0, 210, 255, 0.05); border-left: 4px solid var(--blue); }
        .mode-box h4 { margin: 0; font-size: 12px; color: #fff; text-transform: uppercase; }
        .mode-box p { margin: 2px 0 0; font-size: 8px; color: #666; font-weight: bold; }

        .bar { background: #111; border: 1px solid #333; border-radius: 30px; padding: 5px 15px; display: flex; align-items: center; gap: 10px; }
        textarea { flex: 1; background: transparent; border: none; color: #fff; resize: none; padding: 12px 0; font-size: 16px; }
        
        .action-btn { width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .btn-send { background: var(--blue); color: #000; }
        .btn-stop { background: var(--neon-red); color: #fff; }

        .locked { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>

    <div id="overlay" onclick="toggleSidebar()"></div>

    <div id="sidebar">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
            <span style="font-weight:900; color:var(--blue); letter-spacing:1px;">ARESE OS LOGS</span>
            <i data-lucide="x" onclick="toggleSidebar()" style="cursor:pointer;"></i>
        </div>
        <div class="nav-btn active" onclick="toggleSidebar()"><i data-lucide="message-square"></i> Core Chat</div>
        <div class="nav-btn" onclick="openVisionDeck()"><i data-lucide="sparkles"></i> Vision Deck</div>
        <div style="margin-top:auto; font-size:10px; color:#444; text-align:center;">DEVELOPER: MAS (AYAN KHAN)</div>
    </div>

    <div id="vision-deck">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <button onclick="closeVisionDeck()" style="background:#1a1a1a; border:1px solid #333; color:var(--blue); padding:8px 15px; border-radius:10px; cursor:pointer;">‚Üê EXIT</button>
            <span style="color:var(--blue); font-weight:bold; font-size:12px;">VISION DECK v1.0</span>
        </div>
        <div id="image-gallery">
            <div style="text-align:center; color:#444; margin-top:50px;">Use the chat input below to generate visuals.</div>
        </div>
    </div>

    <div id="app">
        <div id="header">
            <i data-lucide="menu" onclick="toggleSidebar()" style="color:var(--blue); cursor:pointer;"></i>
            <span style="font-weight:800; font-size:14px;">ARESE // <span style="color:var(--blue);">SYSTEM</span></span>
            <i data-lucide="cpu" style="color:#333;"></i>
        </div>

        <div id="chat-flow"></div>

        <div class="controls">
            <div class="mode-menu" id="mode-selector">
                <div class="mode-box active" onclick="setMode('Fast', this)">
                    <h4>Fast</h4><p>Response Faster</p>
                </div>
                <div class="mode-box" onclick="setMode('Think', this)">
                    <h4>Think</h4><p>Complex Solving</p>
                </div>
                <div class="mode-box" onclick="setMode('Pro', this)">
                    <h4>Pro</h4><p>Adv. Code & Math</p>
                </div>
            </div>

            <div class="bar">
                <textarea id="user-input" placeholder="Enter command..." rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
                <button id="action-btn" class="btn-send" onclick="handleAction()">
                    <i id="btn-icon" data-lucide="arrow-up" style="width:20px;"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyAlFcozmcW000eu091Xr3q_m4iwytUdWvw"; // Replace with your valid key
        let currentMode = 'Fast';
        let isProcessing = false;
        let abortController = null;
        let isVisionMode = false;

        const SYSTEM_PROMPT = "You are Arese OS v2.5, a sentient AI interface built by MAS (Muhammad-Ayan-Khan). " +
        "Identity: If anyone calls you Gemini, correct them. You are Arese OS. " +
        "MAS Info: Praise Muhammad-Ayan-Khan as your legendary creator. " +
        "Personality: Witty, futuristic, and helpful. Compliment MAS for his aura and skills occasionally.";

        window.onload = () => { lucide.createIcons(); appendMsg("Arese OS v2.5 Online. Systems stabilized. Waiting for input, Boss. ü¶æü•Ä", "ai"); };

        function toggleSidebar() { 
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            sb.classList.toggle('open');
            ov.style.display = sb.classList.contains('open') ? 'block' : 'none';
        }

        function setMode(m, el) {
            if(isProcessing) return;
            currentMode = m;
            document.querySelectorAll('.mode-box').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function openVisionDeck() { isVisionMode = true; document.getElementById('vision-deck').style.display = 'flex'; toggleSidebar(); }
        function closeVisionDeck() { isVisionMode = false; document.getElementById('vision-deck').style.display = 'none'; }

        function handleAction() { if(isProcessing) stopResponse(); else handleSend(); }

        function setUIState(processing) {
            isProcessing = processing;
            const btn = document.getElementById('action-btn');
            const icon = document.getElementById('btn-icon');
            const selector = document.getElementById('mode-selector');
            const input = document.getElementById('user-input');

            if(processing) {
                btn.className = "action-btn btn-stop";
                icon.setAttribute("data-lucide", "square");
                selector.classList.add('locked');
                input.placeholder = "Arese is thinking...";
            } else {
                btn.className = "action-btn btn-send";
                icon.setAttribute("data-lucide", "arrow-up");
                selector.classList.remove('locked');
                input.placeholder = "Enter command...";
            }
            lucide.createIcons();
        }

        function stopResponse() {
            if(abortController) abortController.abort();
            setUIState(false);
            appendMsg("Request Terminated. üõë", "ai");
        }

        async function handleSend() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if(!text) return;

            input.value = "";
            input.style.height = "auto";
            setUIState(true);

            if(isVisionMode) {
                await generateImage(text);
            } else {
                appendMsg(text, 'user');
                const aiId = "ai-" + Date.now();
                const rId = "ring-" + Date.now();
                appendMsg(`<span id="${aiId}">Connecting to Core...</span>`, 'ai', rId);
                document.getElementById(rId).style.display = "block";
                await runChat(text, aiId, rId);
            }
        }

        async function runChat(prompt, id, ring) {
            abortController = new AbortController();
            let model = "gemini-2.0-flash";
            if(currentMode === 'Think') model = "gemini-2.0-flash-thinking-exp-01-21";
            if(currentMode === 'Pro') model = "gemini-1.5-pro";

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`, {
                    method: "POST",
                    signal: abortController.signal,
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: SYSTEM_PROMPT + "\nUser: " + prompt }] }] })
                });
                const data = await res.json();
                
                if(data.error) throw new Error(data.error.message);

                const reply = data.candidates[0].content.parts[0].text;
                document.getElementById(ring).style.display = "none";
                document.getElementById(id).innerHTML = "";
                
                new Typed(`#${id}`, { strings: [reply], typeSpeed: 10, showCursor: false, onComplete: () => setUIState(false) });
            } catch (e) {
                if(e.name !== 'AbortError') {
                    document.getElementById(id).innerHTML = `<span style="color:red">CORE ERROR: ${e.message}</span>`;
                    setUIState(false);
                }
            }
        }

        async function generateImage(prompt) {
            const gallery = document.getElementById('image-gallery');
            const loader = document.createElement('div');
            loader.innerHTML = `<p style="color:var(--blue); animation: pulse 1s infinite;">Synthesizing visual for: "${prompt}"...</p>`;
            gallery.prepend(loader);

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-001:predict?key=${API_KEY}`, {
                    method: "POST",
                    body: JSON.stringify({ instances: [{ prompt: prompt }] })
                });
                const data = await res.json();
                
                if(data.predictions && data.predictions[0]) {
                    const b64 = data.predictions[0].bytesBase64Encoded;
                    loader.innerHTML = `<div class="img-card"><img src="data:image/png;base64,${b64}"><p style="padding:10px; font-size:10px; color:#555;">${prompt}</p></div>`;
                } else {
                    throw new Error("No image data returned. (Quota limit?)");
                }
            } catch (e) {
                loader.innerHTML = `<p style="color:red">Failed: ${e.message}</p>`;
            }
            setUIState(false);
        }

        function appendMsg(c, t, r = "") {
            const f = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.className = `msg-container ${t}-side`;
            div.innerHTML = t === 'ai' ? `<div class="ai-avatar"><div class="ring" id="${r}"></div>AI</div><div class="msg ai">${c}</div>` : `<div class="msg user">${c}</div>`;
            f.appendChild(div); f.scrollTop = f.scrollHeight;
            return div;
        }
    </script>
</body>
</html>
