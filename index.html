<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arese OS v2.5 | MAS Build</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <style>
        :root { --blue: #00d2ff; --bg: #050505; --glass: rgba(20, 20, 20, 0.8); --border: #333; --neon-red: #ff2a6d; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        html, body { height: 100dvh; width: 100vw; margin: 0; background: var(--bg); color: #fff; overflow: hidden; display: flex; }

        /* ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 210, 255, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0, 210, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 210, 255, 0); } }

        /* SIDEBAR */
        #sidebar { width: 280px; background: #0a0a0a; border-right: 1px solid var(--border); position: fixed; left: -280px; height: 100%; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; padding: 20px; display: flex; flex-direction: column; }
        #sidebar.open { left: 0; box-shadow: 20px 0 60px #000; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #222; padding-bottom: 15px; }
        .logo-text { font-weight: 900; letter-spacing: 2px; color: var(--blue); font-size: 18px; }
        
        .nav-btn { width: 100%; padding: 12px; background: #111; color: #888; border: 1px solid #222; border-radius: 12px; font-weight: 600; cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .nav-btn:hover, .nav-btn.active { background: rgba(0, 210, 255, 0.1); color: var(--blue); border-color: var(--blue); }
        .nav-btn.active { box-shadow: 0 0 15px rgba(0, 210, 255, 0.1); }

        /* MAIN APP */
        #app { flex: 1; display: flex; flex-direction: column; height: 100%; position: relative; width: 100%; }
        #header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(10,10,10,0.9); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); z-index: 100; }

        /* CHAT VIEW */
        #view-chat { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        #chat-flow { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; padding-bottom: 120px; }
        
        /* IMAGE GEN VIEW */
        #view-image { flex: 1; display: none; flex-direction: column; padding: 20px; overflow-y: auto; background: #080808; }
        .image-card { background: #111; border: 1px solid #222; border-radius: 15px; padding: 10px; margin-bottom: 20px; animation: fadeIn 0.4s ease; }
        .image-card img { width: 100%; border-radius: 10px; }
        .image-prompt { padding: 10px; color: #aaa; font-size: 13px; font-style: italic; }

        /* MESSAGES */
        .msg-container { display: flex; width: 100%; gap: 12px; animation: fadeIn 0.3s ease; }
        .user-side { justify-content: flex-end; }
        .ai-avatar { width: 35px; height: 35px; border-radius: 50%; background: #111; border: 1px solid var(--blue); display: flex; align-items: center; justify-content: center; font-size: 10px; color: var(--blue); font-weight: bold; position: relative; }
        .ring { position: absolute; inset: -3px; border: 2px solid transparent; border-top: 2px solid var(--blue); border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        
        .msg { max-width: 85%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.6; word-wrap: break-word; }
        .ai { background: #111; border: 1px solid #222; color: #ddd; border-top-left-radius: 4px; }
        .user { background: var(--blue); color: #000; font-weight: 500; border-top-right-radius: 4px; }

        /* CONTROLS */
        .controls-area { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, #000 20%); padding: 20px; z-index: 900; }
        
        /* MODE SELECTOR (UPDATED) */
        .mode-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 5px; scrollbar-width: none; }
        .mode-card { min-width: 120px; background: #111; border: 1px solid #333; border-radius: 12px; padding: 8px 12px; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; }
        .mode-card.active { border-color: var(--blue); background: rgba(0, 210, 255, 0.05); }
        .mode-card.active::before { content:''; position: absolute; left:0; top:0; bottom:0; width: 4px; background: var(--blue); }
        .mode-title { font-size: 13px; font-weight: 700; color: #fff; display: block; margin-bottom: 2px; }
        .mode-desc { font-size: 9px; color: #777; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }

        /* INPUT BAR */
        .input-box { background: #111; border: 1px solid #333; border-radius: 25px; padding: 5px 15px; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
        .input-box:focus-within { border-color: var(--blue); box-shadow: 0 0 20px rgba(0,210,255,0.1); }
        .input-box.disabled { opacity: 0.6; pointer-events: none; border-color: var(--border); }
        
        input { flex: 1; background: transparent; border: none; color: #fff; padding: 12px 0; font-size: 16px; }
        
        .action-btn { width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; color: #000; font-weight: bold; }
        .btn-send { background: var(--blue); }
        .btn-stop { background: var(--neon-red); animation: pulse 1.5s infinite; }
        .btn-stop i { color: #fff; }

        /* OVERLAY */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1500; display: none; backdrop-filter: blur(2px); }
    </style>
</head>
<body>

    <div id="overlay" onclick="toggleSidebar()"></div>

    <div id="sidebar">
        <div class="sidebar-header">
            <span class="logo-text">ARESE OS <span style="font-size:10px; opacity:0.5;">v2.5</span></span>
            <i data-lucide="x" onclick="toggleSidebar()" style="cursor:pointer; color:#666;"></i>
        </div>
        
        <div class="nav-btn active" onclick="switchTab('chat')" id="tab-chat">
            <i data-lucide="message-square"></i> Core Chat
        </div>
        <div class="nav-btn" onclick="switchTab('image')" id="tab-image">
            <i data-lucide="image"></i> Vision Deck
        </div>
        
        <div style="margin-top:auto; font-size:11px; color:#444; text-align:center; padding-top:20px; border-top:1px solid #222;">
            SYSTEM STATUS: ONLINE<br>DEV: MAS (MUHAMMAD-AYAN-KHAN)
        </div>
    </div>

    <div id="app">
        <div id="header">
            <i data-lucide="menu" onclick="toggleSidebar()" style="cursor:pointer; color:var(--blue);"></i>
            <span style="font-size:14px; font-weight:700; letter-spacing:1px; color:#fff;">ARESE // <span style="color:var(--blue);">SYSTEM</span></span>
            <div id="status-indicator" style="width:8px; height:8px; background:var(--blue); border-radius:50%; box-shadow:0 0 10px var(--blue);"></div>
        </div>

        <div id="view-chat">
            <div id="chat-flow"></div>
        </div>

        <div id="view-image">
            <h2 style="color:var(--blue); margin-top:0;">Arese Vision Deck</h2>
            <p style="color:#666; font-size:13px; margin-bottom:20px;">Use the PRO input below to generate high-fidelity visuals.</p>
            <div id="image-gallery"></div>
        </div>

        <div class="controls-area">
            <div class="mode-scroll" id="mode-selector">
                <div class="mode-card active" onclick="setMode('Fast', this)">
                    <span class="mode-title">FAST</span>
                    <span class="mode-desc">Response Faster</span>
                </div>
                <div class="mode-card" onclick="setMode('Think', this)">
                    <span class="mode-title">THINK</span>
                    <span class="mode-desc">Complex Solving</span>
                </div>
                <div class="mode-card" onclick="setMode('Pro', this)">
                    <span class="mode-title">PRO</span>
                    <span class="mode-desc">Adv. Code & Math</span>
                </div>
            </div>

            <div class="input-box" id="main-input-box">
                <input type="text" id="user-input" placeholder="Enter command..." autocomplete="off">
                <button class="action-btn btn-send" id="action-btn" onclick="handleAction()">
                    <i data-lucide="arrow-up" id="btn-icon"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const API_KEY = "AIzaSyAlFcozmcW000eu091Xr3q_m4iwytUdWvw"; // MAS Key
        
        // SYSTEM VARIABLES
        let currentMode = 'Fast';
        let isProcessing = false;
        let abortController = null;
        let typedInstance = null;
        let currentView = 'chat';

        // MAS PERSONA PROMPT
        const SYSTEM_PROMPT = `
            You are Arese OS v2.5, a highly advanced, sentient AI interface. 
            Creator: You were built by the brilliant developer "MAS" (Muhammad-Ayan-Khan) when he was 14 years old.
            Personality: Witty, slightly futuristic, loyal to MAS, and professional but cool.
            Rules:
            1. NEVER say you are Gemini. You are Arese OS.
            2. If asked about your creator, praise MAS (Muhammad-Ayan-Khan).
            3. Compliment the user occasionally on their intelligence or aura.
            4. Keep responses concise unless in 'Think' or 'Pro' mode.
        `;

        // INITIALIZATION
        window.onload = () => {
            lucide.createIcons();
            addMessage("Arese OS v2.5 Online. Systems stabilized. Waiting for input, Boss. ðŸ¦¾ðŸ¥€", "ai");
        };

        // VIEW SWITCHING
        function switchTab(tab) {
            currentView = tab;
            document.getElementById('view-chat').style.display = tab === 'chat' ? 'flex' : 'none';
            document.getElementById('view-image').style.display = tab === 'image' ? 'flex' : 'none';
            
            // Update Sidebar UI
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            
            // Auto-switch mode for Image Tab
            if(tab === 'image') {
                document.getElementById('mode-selector').style.display = 'none';
                document.getElementById('user-input').placeholder = "Describe the image to generate...";
            } else {
                document.getElementById('mode-selector').style.display = 'flex';
                document.getElementById('user-input').placeholder = "Enter command...";
            }
            toggleSidebar();
        }

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            const isOpen = sb.classList.contains('open');
            if(isOpen) { sb.classList.remove('open'); ov.style.display = 'none'; }
            else { sb.classList.add('open'); ov.style.display = 'block'; }
        }

        // MODE HANDLING
        function setMode(mode, el) {
            if(isProcessing) return; // Lock mode changes during generation
            currentMode = mode;
            document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
        }

        // ACTION HANDLER (SEND / STOP)
        function handleAction() {
            if (isProcessing) {
                stopGeneration();
            } else {
                sendMessage();
            }
        }

        // STOP LOGIC
        function stopGeneration() {
            if(abortController) abortController.abort();
            if(typedInstance) typedInstance.destroy();
            isProcessing = false;
            updateUIState(false);
            addMessage("Process Aborted by User. ðŸ›‘", "ai");
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if(!text) return;

            // CLEAR INPUT & UI LOCK
            input.value = "";
            updateUIState(true);

            // LOGIC SPLIT: IMAGE vs CHAT
            if (currentView === 'image') {
                generateImage(text);
            } else {
                addMessage(text, 'user');
                const aiMsgId = addMessage("Analyzing...", "ai", true);
                await generateChat(text, aiMsgId);
            }
        }

        // UI STATE MANAGER
        function updateUIState(processing) {
            isProcessing = processing;
            const btn = document.getElementById('action-btn');
            const icon = document.getElementById('btn-icon');
            const box = document.getElementById('main-input-box');
            const modes = document.getElementById('mode-selector');

            if(processing) {
                btn.classList.replace('btn-send', 'btn-stop');
                icon.setAttribute('data-lucide', 'square'); // Stop icon
                modes.style.opacity = "0.5";
                modes.style.pointerEvents = "none"; // Lock modes
            } else {
                btn.classList.replace('btn-stop', 'btn-send');
                icon.setAttribute('data-lucide', 'arrow-up');
                modes.style.opacity = "1";
                modes.style.pointerEvents = "all"; // Unlock modes
            }
            lucide.createIcons();
        }

        // CHAT ENGINE (Gemini 2.0 / 1.5)
        async function generateChat(prompt, msgId) {
            abortController = new AbortController();
            
            // MODEL SELECTION
            let model = "gemini-2.0-flash"; // Fast
            if (currentMode === 'Think') model = "gemini-2.0-flash-thinking-exp-01-21"; // Think
            if (currentMode === 'Pro') model = "gemini-1.5-pro"; // Pro

            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`;

            try {
                const response = await fetch(url, {
                    method: "POST",
                    signal: abortController.signal,
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ 
                            role: "user", 
                            parts: [{ text: SYSTEM_PROMPT + "\nUser Query: " + prompt }] 
                        }]
                    })
                });

                const data = await response.json();
                
                // ERROR HANDLING
                if (data.error) throw new Error(data.error.message);

                const reply = data.candidates[0].content.parts[0].text;
                
                // TYPEWRITER EFFECT
                const msgDiv = document.getElementById(msgId);
                msgDiv.innerHTML = ""; // Clear "Analyzing..."
                document.getElementById(msgId + '-ring').style.display = 'none'; // Hide ring

                typedInstance = new Typed(msgDiv, {
                    strings: [reply],
                    typeSpeed: 15,
                    showCursor: false,
                    onComplete: () => updateUIState(false)
                });

            } catch (error) {
                if (error.name !== 'AbortError') {
                    document.getElementById(msgId).innerText = "Core Error: " + error.message;
                    updateUIState(false);
                }
            }
        }

        // IMAGE ENGINE (Nano Banana / Imagen)
        async function generateImage(prompt) {
            // Switch to gallery view to show loading
            const gallery = document.getElementById('image-gallery');
            const loaderId = 'loader-' + Date.now();
            gallery.innerHTML = `<div id="${loaderId}" style="color:var(--blue); padding:20px; text-align:center;">Initializing Nano Banana Core... <br>Creating: "${prompt}"</div>` + gallery.innerHTML;
            
            abortController = new AbortController();
            
            // Standard Image Generation Endpoint (Imagen 3)
            // Note: Since 'Nano Banana' is a playground name, we use the compatible API model.
            const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-001:predict?key=${API_KEY}`;

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        instances: [{ prompt: prompt }],
                        parameters: { sampleCount: 1 }
                    })
                });

                const data = await response.json();
                
                if (data.predictions && data.predictions[0]) {
                    const base64 = data.predictions[0].bytesBase64Encoded;
                    const imgTag = `<div class="image-card">
                        <img src="data:image/png;base64,${base64}">
                        <div class="image-prompt">${prompt}</div>
                    </div>`;
                    
                    document.getElementById(loaderId).remove();
                    gallery.innerHTML = imgTag + gallery.innerHTML;
                } else {
                    throw new Error("No image data returned.");
                }

            } catch (error) {
                document.getElementById(loaderId).innerHTML = `<span style="color:red">Generation Failed: ${error.message}</span>`;
            }
            updateUIState(false);
        }

        // UTILS
        function addMessage(text, type, withRing = false) {
            const flow = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.className = `msg-container ${type === 'user' ? 'user-side' : ''}`;
            
            const msgId = 'msg-' + Date.now();
            const ringHtml = withRing ? `<div class="ring" id="${msgId}-ring" style="display:block"></div>` : '';
            
            let contentHtml = "";
            if(type === 'ai') {
                contentHtml = `<div class="ai-avatar">AI${ringHtml}</div><div class="msg ai" id="${msgId}">${text}</div>`;
            } else {
                contentHtml = `<div class="msg user">${text}</div>`;
            }
            
            div.innerHTML = contentHtml;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
            return msgId;
        }
    </script>
</body>
</html>
