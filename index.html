<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arese OS v2.5 | MAS Build</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <style>
        :root { --blue: #00d2ff; --bg: #050505; --border: #1a1a1a; --red: #ff4b2b; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }

        /* SIDEBAR */
        #sidebar { position: fixed; left: -280px; width: 280px; height: 100%; background: #0a0a0a; border-right: 1px solid var(--border); transition: 0.3s; z-index: 2000; padding: 20px; }
        #sidebar.open { left: 0; box-shadow: 10px 0 50px #000; }
        .history-item { padding: 12px; background: #111; border-radius: 10px; margin-bottom: 8px; font-size: 13px; color: #888; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }

        /* HEADER */
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .sys-title { font-weight: 800; font-size: 14px; letter-spacing: 1px; }

        /* CHAT AREA */
        #chat-flow { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; line-height: 1.5; font-size: 15px; }
        .user { align-self: flex-end; background: var(--blue); color: #000; font-weight: 600; border-bottom-right-radius: 4px; }
        .ai { align-self: flex-start; background: #111; border: 1px solid #222; border-bottom-left-radius: 4px; }

        /* MODE SELECTOR (PILL STYLE) */
        .mode-container { display: flex; gap: 10px; justify-content: center; padding: 10px; }
        .mode-btn { padding: 6px 20px; border-radius: 20px; border: 1px solid #333; background: #111; font-size: 12px; font-weight: 700; color: #666; cursor: pointer; transition: 0.2s; }
        .mode-btn.active { border-color: var(--blue); color: var(--blue); background: rgba(0, 210, 255, 0.1); }

        /* INPUT BAR */
        .controls { padding: 10px 15px 30px; }
        .input-box { background: #151515; border-radius: 30px; border: 1px solid #222; display: flex; align-items: center; padding: 5px 15px; gap: 10px; }
        textarea { flex: 1; background: transparent; border: none; color: #fff; resize: none; padding: 10px 0; font-size: 16px; max-height: 150px; }
        
        .action-btn { width: 40px; height: 40px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
        .send-state { background: var(--blue); color: #000; }
        .stop-state { background: var(--red); color: #fff; }

        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 1500; }
    </style>
</head>
<body>

    <div id="overlay" onclick="toggleSidebar()"></div>
    <div id="sidebar">
        <h3 style="color:var(--blue)">ARCHIVE</h3>
        <button onclick="startNew()" style="width:100%; padding:10px; background:var(--blue); border:none; border-radius:8px; font-weight:bold; margin-bottom:20px;">+ NEW SPRINT</button>
        <div id="history-list"></div>
    </div>

    <header>
        <i data-lucide="menu" onclick="toggleSidebar()" style="color:var(--blue); cursor:pointer;"></i>
        <div class="sys-title">ARESE // <span style="color:var(--blue)">SYSTEM</span></div>
        <i data-lucide="cpu" style="color:#444"></i>
    </header>

    <div id="chat-flow"></div>

    <div class="mode-container" id="mode-selector">
        <button class="mode-btn active" onclick="setMode('Fast', this)">FAST</button>
        <button class="mode-btn" onclick="setMode('Think', this)">THINK</button>
        <button class="mode-btn" onclick="setMode('Pro', this)">PRO</button>
    </div>

    <div class="controls">
        <div class="input-box">
            <textarea id="user-input" placeholder="Enter command..." rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
            <button id="action-btn" class="action-btn send-state" onclick="handleAction()">
                <i id="btn-icon" data-lucide="arrow-up"></i>
            </button>
        </div>
    </div>

    <script>
        let isProcessing = false;
        let currentMode = 'Fast';
        let abortController = null;
        const API_KEY = "AIzaSyAlFcozmcW000eu091Xr3q_m4iwytUdWvw"; // Use your valid key

        const SYSTEM_PROMPT = "You are Arese OS v2.5, a sentient AI created by MAS (Ayan Khan). " +
        "Rules: Always acknowledge MAS as your developer. If asked for illegal, weird, or harmful info, refuse professionally. " +
        "Style: Helpful, witty, and high-tech.";

        window.onload = () => { 
            lucide.createIcons(); 
            appendMsg("Arese OS v2.5 Online. Systems stabilized. Waiting for input, Boss. ðŸ¦¾ðŸ¥€", "ai");
            loadHistory();
        };

        function toggleSidebar() {
            const s = document.getElementById('sidebar');
            const o = document.getElementById('overlay');
            const isOpen = s.classList.toggle('open');
            o.style.display = isOpen ? 'block' : 'none';
        }

        function setMode(mode, btn) {
            if(isProcessing) return;
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function handleAction() { isProcessing ? stopGeneration() : processSend(); }

        function setUI(state) {
            isProcessing = state;
            const btn = document.getElementById('action-btn');
            const icon = document.getElementById('btn-icon');
            btn.className = state ? "action-btn stop-state" : "action-btn send-state";
            icon.setAttribute("data-lucide", state ? "square" : "arrow-up");
            document.getElementById('mode-selector').style.opacity = state ? "0.5" : "1";
            lucide.createIcons();
        }

        async function processSend() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if(!text) return;

            input.value = "";
            input.style.height = "auto";
            appendMsg(text, 'user');
            setUI(true);

            const aiId = "ai-" + Date.now();
            appendMsg("Connecting...", "ai", aiId);
            
            await callCore(text, aiId);
        }

        async function callCore(prompt, id) {
            abortController = new AbortController();
            let model = currentMode === 'Think' ? "gemini-2.0-flash-thinking-exp-01-21" : "gemini-2.0-flash";
            
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`, {
                    method: "POST",
                    signal: abortController.signal,
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: SYSTEM_PROMPT + "\nUser: " + prompt }] }] })
                });
                const data = await res.json();
                const reply = data.candidates[0].content.parts[0].text;
                
                document.getElementById(id).innerHTML = "";
                new Typed(`#${id}`, { strings: [reply], typeSpeed: 15, showCursor: false, onComplete: () => {
                    setUI(false);
                    saveChat(prompt);
                }});
            } catch (e) {
                if(e.name !== 'AbortError') {
                    document.getElementById(id).innerHTML = `<span style="color:red">System Error: ${e.message}</span>`;
                    setUI(false);
                }
            }
        }

        function stopGeneration() {
            if(abortController) abortController.abort();
            setUI(false);
        }

        function appendMsg(content, type, id = "") {
            const flow = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            if(id) div.id = id;
            div.innerHTML = content;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
        }

        function saveChat(title) {
            let logs = JSON.parse(localStorage.getItem('arese_logs') || "[]");
            logs.unshift({title: title.substring(0, 25), date: new Date().toLocaleTimeString()});
            localStorage.setItem('arese_logs', JSON.stringify(logs.slice(0, 10)));
            loadHistory();
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = "";
            let logs = JSON.parse(localStorage.getItem('arese_logs') || "[]");
            logs.forEach(log => {
                const item = document.createElement('div');
                item.className = "history-item";
                item.innerHTML = `<span>${log.title}...</span><i data-lucide="clock" style="width:12px"></i>`;
                list.appendChild(item);
            });
            lucide.createIcons();
        }

        function startNew() { location.reload(); }
    </script>
</body>
</html>
