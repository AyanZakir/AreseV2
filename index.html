<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arese OS v3.0</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <style>
        :root { --blue: #00d2ff; --bg: #0b0b0b; --glass: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; overflow: hidden; display: flex; }

        /* SIDEBAR */
        #sidebar { width: 280px; background: #080808; border-right: 1px solid #151515; position: fixed; left: -280px; height: 100%; transition: 0.3s ease; z-index: 1000; padding: 25px; display: flex; flex-direction: column; }
        #sidebar.open { left: 0; }
        .sidebar-item { padding: 12px; border-radius: 10px; margin-bottom: 8px; border: 1px solid #222; cursor: pointer; font-size: 14px; }

        #app { flex: 1; display: flex; flex-direction: column; width: 100%; }
        #header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: #080808; border-bottom: 1px solid #151515; }
        
        #chat-flow { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .msg-container { display: flex; width: 100%; }
        .user-side { justify-content: flex-end; }
        .ai-side { justify-content: flex-start; }
        .msg { max-width: 85%; padding: 14px 18px; border-radius: 20px; font-size: 15px; line-height: 1.5; }
        .user { background: #222; border: 1px solid #333; border-bottom-right-radius: 4px; }
        .ai { background: var(--glass); border: 1px solid var(--blue); border-bottom-left-radius: 4px; color: var(--blue); }

        /* MEDIA MENU */
        #media-tray { position: absolute; bottom: 100px; left: 20px; background: #151515; border: 1px solid #333; border-radius: 20px; display: none; flex-direction: column; padding: 10px; width: 200px; z-index: 100; }
        .m-item { display: flex; align-items: center; gap: 12px; padding: 12px; cursor: pointer; border-radius: 10px; font-size: 14px; }
        .m-item:hover { background: #222; }
        .show { display: flex !important; }

        .controls { padding: 15px 20px 35px; background: #050505; border-top: 1px solid #111; position: relative; }
        .modes { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; }
        .mode-btn { background: #111; border: 1px solid #222; color: #555; padding: 7px 16px; border-radius: 20px; font-size: 11px; font-weight: 700; cursor: pointer; }
        .mode-btn.active { border-color: var(--blue); color: var(--blue); background: rgba(0,210,255,0.1); }
        
        .bar { display: flex; gap: 15px; align-items: center; background: #111; padding: 6px 18px; border-radius: 35px; border: 1px solid #222; }
        textarea { flex: 1; background: transparent; border: none; color: #fff; outline: none; resize: none; font-size: 16px; }
        .btn-send { background: var(--blue); border: none; width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h3 style="color:var(--blue);">HISTORY</h3>
        <button class="sidebar-item" onclick="resetChat()">+ New Chat</button>
        <div id="hist-list"></div>
    </div>

    <div id="app">
        <div id="header">
            <i data-lucide="menu" onclick="toggleSidebar()" style="color:var(--blue); cursor:pointer;"></i>
            <div style="font-weight:900; color:var(--blue);">ARESE v3.0</div>
            <button onclick="alert('Live Call Spooling...')" style="background:#fff; color:#000; border-radius:20px; padding:5px 12px; font-weight:bold; font-size:11px; display:flex; gap:5px;"><i data-lucide="phone" style="width:14px;"></i> LIVE CALL</button>
        </div>

        <div id="chat-flow"></div>

        <div class="controls">
            <div id="media-tray">
                <div class="m-item" onclick="pick('image/*')"><i data-lucide="camera"></i> Camera</div>
                <div class="m-item" onclick="pick('image/*')"><i data-lucide="image"></i> Gallery</div>
                <div class="m-item" onclick="pick('*/*')"><i data-lucide="file"></i> Files</div>
                <div class="m-item" onclick="pick('audio/*')"><i data-lucide="music"></i> Audio</div>
            </div>

            <div class="modes">
                <button class="mode-btn active" onclick="setMode('fast', this)">Fast</button>
                <button class="mode-btn" onclick="setMode('think', this)">Think</button>
                <button class="mode-btn" onclick="setMode('pro', this)">Pro</button>
            </div>

            <div class="bar">
                <i data-lucide="plus" onclick="toggleTray()" style="color:#666; cursor:pointer;"></i>
                <textarea id="user-input" placeholder="Ask or draw..." rows="1"></textarea>
                <button class="btn-send" onclick="execute()"><i data-lucide="arrow-up"></i></button>
                <i data-lucide="mic" style="color:#666;"></i>
            </div>
        </div>
    </div>

    <input type="file" id="hidden-file" style="display:none;" onchange="handleFile(this)">

    <script src="vision.js"></script>
    <script>
        const GROQ_KEY = "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";
        window.currentMode = "fast";

        window.onload = () => { lucide.createIcons(); resetChat(); };

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function toggleTray() { document.getElementById('media-tray').classList.toggle('show'); }
        function pick(t) { document.getElementById('hidden-file').accept = t; document.getElementById('hidden-file').click(); toggleTray(); }

        function setMode(m, btn) {
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            window.currentMode = m;
        }

        function resetChat() {
            document.getElementById('chat-flow').innerHTML = "";
            appendMsg("Arese v3.0 Online. Modes: Fast, Think, Pro. ü¶æü•Äüîí", "ai");
            if(document.getElementById('sidebar').classList.contains('open')) toggleSidebar();
        }

        async function execute() {
            const input = document.getElementById('user-input');
            const prompt = input.value.trim();
            if(!prompt) return;

            appendMsg(prompt, "user");
            input.value = "";

            if(prompt.toLowerCase().includes("draw") || prompt.toLowerCase().includes("generate")) {
                const id = "vision-" + Date.now();
                appendMsg(`<span id="${id}">Vision Engine generating... üé®</span>`, "ai");
                generateImage(prompt, id); // Uses vision.js
                return;
            }
            fetchAI(prompt);
        }

        async function fetchAI(prompt) {
            const id = "ai-" + Date.now();
            appendMsg(`<span id="${id}">...</span>`, "ai");
            try {
                const model = (window.currentMode === "fast") ? "llama-3.1-8b-instant" : "llama-3.3-70b-versatile";
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: model, messages: [{role: "user", content: prompt}] })
                });
                const data = await res.json();
                const reply = data.choices[0].message.content;
                document.getElementById(id).innerText = "";
                new Typed(`#${id}`, { strings: [reply], typeSpeed: 25, showCursor: false });
            } catch (e) { document.getElementById(id).innerText = "Link failed. ‚ö†Ô∏è"; }
        }

        function appendMsg(content, type) {
            const flow = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.className = `msg-container ${type}-side`;
            div.innerHTML = `<div class="msg ${type}">${content}</div>`;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
        }

        function handleFile(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                let media = file.type.startsWith('image/') ? `<img src="${e.target.result}" style="width:100%; border-radius:10px; margin-top:10px;">` : `<video src="${e.target.result}" controls style="width:100%; border-radius:10px; margin-top:10px;"></video>`;
                appendMsg(`Sent: ${file.name}${media}`, "user");
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
